<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOS.OS | Единая Система Управления</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* =========================================
           CORE STYLES & VARIABLES
           ========================================= */
        :root {
            /* Palette */
            --bg-dark: #0f1115;
            --bg-panel: #161b22;
            --bg-input: #0d1117;
            --border-color: #30363d;
            
            /* Accents */
            --primary-mvd: #2f81f7; /* Police Blue */
            --primary-mchs: #f85149; /* Medic Red */
            --accent-success: #238636;
            --accent-warning: #d29922;
            --text-main: #c9d1d9;
            --text-muted: #8b949e;

            /* Effects */
            --glass: rgba(22, 27, 34, 0.85);
            --shadow-card: 0 10px 30px rgba(0,0,0,0.5);
            
            /* Current Theme (Changed via JS) */
            --theme-color: var(--primary-mvd); 
        }

        * { box-sizing: border-box; outline: none; }
        
        body, html {
            margin: 0; padding: 0; height: 100vh;
            font-family: 'Segoe UI', 'Roboto', Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow: hidden;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--theme-color); }

        /* =========================================
           BOOT & LOGIN SCREEN
           ========================================= */
        #boot-screen, #login-screen {
            position: fixed; inset: 0; z-index: 9999;
            background: #000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
        }

        .boot-log {
            font-family: 'Consolas', monospace; color: #33ff33;
            width: 80%; max-width: 600px; font-size: 14px;
        }

        .login-card {
            background: var(--bg-panel); padding: 40px; width: 400px;
            border: 1px solid var(--border-color); border-radius: 8px;
            box-shadow: 0 0 50px rgba(47, 129, 247, 0.1);
            position: relative; overflow: hidden;
        }

        .login-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
            background: linear-gradient(90deg, transparent, var(--theme-color), transparent);
        }

        .login-title { font-size: 24px; font-weight: 300; margin-bottom: 20px; text-align: center; letter-spacing: 2px; }
        
        /* Form Elements */
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-label { font-size: 12px; color: var(--text-muted); display: block; margin-bottom: 8px; text-transform: uppercase; }
        
        .input-control {
            width: 100%; background: var(--bg-input); border: 1px solid var(--border-color);
            color: white; padding: 12px; border-radius: 6px; transition: 0.3s;
            font-family: inherit; font-size: 14px;
        }
        .input-control:focus { border-color: var(--theme-color); box-shadow: 0 0 0 3px rgba(47, 129, 247, 0.1); }

        .btn-main {
            width: 100%; background: var(--theme-color); color: white; border: none;
            padding: 14px; border-radius: 6px; font-weight: 600; cursor: pointer;
            text-transform: uppercase; letter-spacing: 1px; transition: 0.3s;
        }
        .btn-main:hover { filter: brightness(1.1); transform: translateY(-2px); }

        /* =========================================
           MAIN INTERFACE LAYOUT
           ========================================= */
        #app-interface { display: none; height: 100vh; grid-template-columns: 260px 1fr; }

        /* Sidebar */
        aside {
            background: var(--bg-panel); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; padding: 20px 0;
        }

        .user-block {
            padding: 0 20px 20px; border-bottom: 1px solid var(--border-color);
            margin-bottom: 10px;
        }
        .user-rank { font-size: 12px; color: var(--theme-color); font-weight: bold; }
        .user-name { font-size: 16px; font-weight: 600; margin-top: 5px; }

        nav ul { list-style: none; padding: 0; margin: 0; }
        nav li {
            padding: 15px 25px; cursor: pointer; color: var(--text-muted);
            display: flex; align-items: center; gap: 12px; transition: 0.2s;
            border-left: 3px solid transparent;
        }
        nav li:hover { background: rgba(255,255,255,0.03); color: white; }
        nav li.active {
            background: rgba(47, 129, 247, 0.05); color: white;
            border-left-color: var(--theme-color);
        }
        nav li i { width: 20px; text-align: center; }

        /* Status Controls */
        .status-panel { margin-top: auto; padding: 20px; border-top: 1px solid var(--border-color); }
        .status-btn {
            font-size: 11px; padding: 8px; width: 100%; margin-bottom: 5px;
            background: transparent; border: 1px solid var(--border-color); color: var(--text-muted);
            cursor: pointer; border-radius: 4px; text-align: left;
        }
        .status-btn.active { background: var(--accent-success); border-color: var(--accent-success); color: white; }
        .status-btn.busy { background: var(--accent-warning); border-color: var(--accent-warning); color: #000; }

        /* Main Content */
        main { display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        header {
            height: 60px; border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; background: var(--bg-panel);
        }

        .clock-widget { font-variant-numeric: tabular-nums; font-weight: bold; font-size: 18px; }
        .department-badge { 
            padding: 5px 12px; background: var(--border-color); 
            border-radius: 20px; font-size: 12px; font-weight: bold; 
        }

        /* Modules */
        .workspace { padding: 30px; overflow-y: auto; height: calc(100vh - 60px); }
        .module-page { display: none; animation: slideIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .module-page.active { display: block; }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* =========================================
           COMPONENTS
           ========================================= */
        .card {
            background: var(--bg-panel); border: 1px solid var(--border-color);
            border-radius: 8px; padding: 25px; margin-bottom: 25px;
        }
        
        .card-title {
            margin-top: 0; margin-bottom: 20px; font-size: 18px;
            display: flex; align-items: center; gap: 10px;
            padding-bottom: 15px; border-bottom: 1px solid var(--border-color);
        }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }

        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .data-table th { text-align: left; color: var(--text-muted); padding: 12px; border-bottom: 2px solid var(--border-color); }
        .data-table td { padding: 12px; border-bottom: 1px solid var(--border-color); color: var(--text-main); }
        .data-table tr:hover td { background: rgba(255,255,255,0.02); }

        /* Badges */
        .badge { padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .badge-red { background: rgba(248, 81, 73, 0.2); color: #ff7b72; border: 1px solid rgba(248, 81, 73, 0.4); }
        .badge-green { background: rgba(35, 134, 54, 0.2); color: #3fb950; border: 1px solid rgba(35, 134, 54, 0.4); }
        .badge-blue { background: rgba(56, 139, 253, 0.2); color: #58a6ff; border: 1px solid rgba(56, 139, 253, 0.4); }

        /* Law Selector */
        .law-selector {
            max-height: 200px; overflow-y: auto; background: var(--bg-input);
            border: 1px solid var(--border-color); border-radius: 6px; padding: 10px;
        }
        .law-item {
            padding: 8px; cursor: pointer; border-radius: 4px; font-size: 13px;
            display: flex; justify-content: space-between;
        }
        .law-item:hover { background: rgba(255,255,255,0.1); }
        .law-item.selected { background: var(--theme-color); color: white; }

        /* Notification Toast */
        #toast-container { position: fixed; bottom: 30px; right: 30px; display: flex; flex-direction: column; gap: 10px; }
        .toast {
            background: var(--bg-panel); border-left: 4px solid var(--theme-color);
            padding: 15px 25px; border-radius: 4px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: flex; align-items: center; gap: 15px; color: white; min-width: 300px;
            animation: slideInRight 0.3s;
        }
        @keyframes slideInRight { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* Quick Search Big Input */
        .big-search { font-size: 24px; padding: 20px; }

    </style>
</head>
<body>

    <audio id="sfx-boot" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
    <audio id="sfx-click" src="https://www.soundjay.com/buttons/button-16.mp3"></audio>
    <audio id="sfx-alert" src="https://www.soundjay.com/mechanical/sounds/mechanical-clank-1.mp3"></audio>

    <div id="boot-screen">
        <div class="boot-log" id="boot-log-text"></div>
    </div>

    <div id="login-screen" style="display:none;">
        <div class="login-card">
            <h2 class="login-title">GOS.OS <span style="font-size:12px; opacity:0.5;">v4.2.1</span></h2>
            
            <div class="form-group">
                <label class="form-label">Идентификатор сотрудника</label>
                <input type="text" class="input-control" id="auth-name" placeholder="Фамилия И.О.">
            </div>

            <div class="form-group">
                <label class="form-label">Департамент</label>
                <select class="input-control" id="auth-dept" onchange="changeThemePreview(this.value)">
                    <option value="MVD">МВД / Полиция / ГИБДД</option>
                    <option value="MCHS">МЧС / Скорая Помощь</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Код доступа</label>
                <input type="password" class="input-control" value="12345">
            </div>

            <button class="btn-main" onclick="startSystem()">Войти в систему</button>
        </div>
    </div>

    <div id="app-interface">
        <aside>
            <div class="user-block">
                <div class="user-rank" id="ui-rank">СЕРЖАНТ</div>
                <div class="user-name" id="ui-name">Иванов И.И.</div>
            </div>
            
            <nav id="nav-menu">
                <ul>
                    <li onclick="openModule('dashboard')" class="active"><i class="fas fa-home"></i> Сводка</li>
                    <li class="role-mvd" onclick="openModule('protocols')"><i class="fas fa-file-contract"></i> Протоколы</li>
                    <li class="role-mvd" onclick="openModule('search')"><i class="fas fa-search"></i> База граждан</li>
                    <li class="role-mvd" onclick="openModule('vehicles')"><i class="fas fa-car"></i> Авто-поиск</li>
                    <li class="role-mchs" onclick="openModule('medical')"><i class="fas fa-notes-medical"></i> Карты пациентов</li>
                    <li class="role-mchs" onclick="openModule('beds')"><i class="fas fa-procedures"></i> Коечный фонд</li>
                    <li onclick="openModule('database')"><i class="fas fa-book"></i> База Знаний</li>
                    <li onclick="openModule('archive')"><i class="fas fa-history"></i> Архив Смены</li>
                </ul>
            </nav>

            <div class="status-panel">
                <label class="form-label">Мой Статус</label>
                <button class="status-btn active" onclick="setStatus(this, 'ДОСТУПЕН')">10-8 Доступен</button>
                <button class="status-btn" onclick="setStatus(this, 'ВЫЕХАЛ')">10-5 В пути</button>
                <button class="status-btn busy" onclick="setStatus(this, 'ЗАНЯТ')">10-6 Занят</button>
            </div>
        </aside>

        <main>
            <header>
                <div class="department-badge" id="ui-dept">DEPT</div>
                <div style="flex-grow:1; text-align:center; font-weight:600; letter-spacing:1px; opacity:0.7;">
                    SECURE CONNECTION ESTABLISHED
                </div>
                <div class="clock-widget" id="clock">00:00:00</div>
            </header>

            <div class="workspace">
                
                <div id="mod-dashboard" class="module-page active">
                    <h2 class="card-title">Оперативная обстановка</h2>
                    
                    <div class="grid-3">
                        <div class="card" style="text-align:center;">
                            <h1 style="font-size:40px; margin:0; color:var(--theme-color);" id="stat-calls">0</h1>
                            <span class="form-label">Вызовов за смену</span>
                        </div>
                        <div class="card" style="text-align:center;">
                            <h1 style="font-size:40px; margin:0; color:var(--accent-warning);" id="stat-reports">0</h1>
                            <span class="form-label">Оформлено отчетов</span>
                        </div>
                        <div class="card" style="text-align:center;">
                            <h1 style="font-size:40px; margin:0; color:var(--accent-success);">A+</h1>
                            <span class="form-label">Эффективность</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-broadcast-tower"></i> Прямая трансляция диспетчера</h3>
                        <div style="height:150px; overflow-y:auto; font-family:'Consolas', monospace; font-size:13px; color:#aaa;" id="live-feed">
                            </div>
                    </div>
                </div>

                <div id="mod-protocols" class="module-page">
                    <div class="card">
                        <h3 class="card-title"><i class="fas fa-pen-alt"></i> Составить протокол</h3>
                        <div class="grid-2">
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Гражданин</label>
                                    <input type="text" class="input-control" id="prot-name" placeholder="ФИО нарушителя">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Паспортные данные / ID</label>
                                    <input type="text" class="input-control" id="prot-id" placeholder="XX-XXXXXX">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Выберите статьи (УК/КоАП)</label>
                                    <div class="law-selector" id="law-list">
                                        </div>
                                </div>
                            </div>
                            <div>
                                <div class="form-group">
                                    <label class="form-label">Описание ситуации</label>
                                    <textarea class="input-control" rows="5" id="prot-desc"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Итоговая мера</label>
                                    <input type="text" class="input-control" id="prot-result" placeholder="Штраф / Срок (рассчитывается автоматически)" readonly>
                                </div>
                                <button class="btn-main" onclick="submitProtocol()">Зарегистрировать протокол</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="mod-search" class="module-page">
                    <div class="card">
                        <input type="text" class="input-control big-search" placeholder="Поиск: ФИО, Номер телефона, ID..." id="search-db-input" onkeyup="searchCitizen()">
                    </div>
                    <div id="search-results">
                        </div>
                </div>

                <div id="mod-medical" class="module-page">
                    <div class="grid-2">
                        <div class="card">
                            <h3 class="card-title">Создание карты вызова</h3>
                            <div class="form-group">
                                <label class="form-label">Пациент</label>
                                <input type="text" class="input-control" id="med-name">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Жалобы (Анамнез)</label>
                                <textarea class="input-control" rows="3" id="med-anamnesis"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Код срочности (Триаж)</label>
                                <select class="input-control" id="med-triage">
                                    <option value="green">ЗЕЛЕНЫЙ (Легкий)</option>
                                    <option value="yellow">ЖЕЛТЫЙ (Средний)</option>
                                    <option value="red">КРАСНЫЙ (Тяжелый/Реанимация)</option>
                                    <option value="black">ЧЕРНЫЙ (Летальный)</option>
                                </select>
                            </div>
                            <button class="btn-main" onclick="submitMedical()" style="background: var(--primary-mchs)">Оформить карту</button>
                        </div>
                        <div class="card">
                            <h3 class="card-title">Активные пациенты</h3>
                            <table class="data-table">
                                <thead><tr><th>Имя</th><th>Статус</th><th>Время</th></tr></thead>
                                <tbody id="med-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="mod-archive" class="module-page">
                    <h2 class="card-title">Архив действий смены</h2>
                    <div class="card" id="archive-content">
                        <p style="text-align:center; color:gray">Записей пока нет.</p>
                    </div>
                    <button class="input-control" onclick="copyReport()" style="width:auto; float:right;">Скопировать отчет для Discord</button>
                </div>

            </div>
        </main>
    </div>

    <div id="toast-container"></div>

    <script>
        // --- DATA LAYER ---
        const LAWS = [
            { id: "1.1", code: "УК", text: "Нанесение телесных повреждений", time: 20, fine: 1000 },
            { id: "2.5", code: "УК", text: "Угон транспортного средства", time: 30, fine: 5000 },
            { id: "3.1", code: "УК", text: "Убийство", time: 100, fine: 20000 },
            { id: "10.5", code: "КоАП", text: "Нарушение ПДД (Скорость)", time: 0, fine: 500 },
            { id: "12.1", code: "КоАП", text: "Неподчинение сотруднику", time: 10, fine: 2000 },
            { id: "228", code: "УК", text: "Хранение запрещенных веществ", time: 40, fine: 10000 },
        ];

        let MOCK_CITIZENS = [
            { name: "Сидоров Алексей Петрович", age: 34, lic: "A, B", status: "WANTED", note: "Вооружен и опасен" },
            { name: "Петрова Мария Ивановна", age: 22, lic: "B", status: "CLEAN", note: "Законопослушная" },
            { name: "Volkov Dmitry", age: 40, lic: "None", status: "PRISON", note: "Заключенный ИК-1" }
        ];

        let CURRENT_USER = { name: "", dept: "" };
        let SESSION_LOGS = [];
        let SELECTED_LAWS = [];

        // --- CORE FUNCTIONS ---

        // Boot Animation
        window.onload = function() {
            const log = document.getElementById('boot-log-text');
            const lines = [
                "BIOS CHECK... OK",
                "LOADING KERNEL... OK",
                "MOUNTING FILE SYSTEM... OK",
                "CONNECTING TO GOVERNMENT SECURE NETWORK...",
                "ESTABLISHING ENCRYPTED TUNNEL (256-bit)... SUCCESS",
                "INITIALIZING UI SUBSYSTEM..."
            ];
            let i = 0;
            const interval = setInterval(() => {
                log.innerHTML += lines[i] + "<br>";
                i++;
                if(i >= lines.length) {
                    clearInterval(interval);
                    setTimeout(() => {
                        document.getElementById('boot-screen').style.display = 'none';
                        document.getElementById('login-screen').style.display = 'flex';
                    }, 800);
                }
            }, 300);
            
            // Render Laws
            const lawContainer = document.getElementById('law-list');
            LAWS.forEach(law => {
                const div = document.createElement('div');
                div.className = 'law-item';
                div.innerHTML = `<span><b>${law.code} ${law.id}</b> ${law.text}</span> <small>${law.fine}$ / ${law.time}м</small>`;
                div.onclick = () => toggleLaw(div, law);
                lawContainer.appendChild(div);
            });
            
            // Random Live Feed
            setInterval(addRandomFeed, 8000);
            updateClock();
        };

        function changeThemePreview(dept) {
            const root = document.documentElement;
            if(dept === 'MVD') root.style.setProperty('--theme-color', '#2f81f7');
            if(dept === 'MCHS') root.style.setProperty('--theme-color', '#f85149');
        }

        function playSound(type) {
            // В реальном проекте раскомментировать
            // document.getElementById('sfx-' + type).play().catch(e => {});
        }

        function startSystem() {
            const name = document.getElementById('auth-name').value;
            const dept = document.getElementById('auth-dept').value;
            
            if(!name) { alert("Введите имя!"); return; }

            CURRENT_USER.name = name;
            CURRENT_USER.dept = dept;

            // Apply Roles
            if(dept === 'MVD') {
                document.documentElement.style.setProperty('--theme-color', '#2f81f7');
                document.querySelectorAll('.role-mchs').forEach(el => el.style.display = 'none');
                document.getElementById('ui-dept').innerText = "POLICE DEPARTMENT";
                document.getElementById('ui-dept').style.color = "#2f81f7";
            } else {
                document.documentElement.style.setProperty('--theme-color', '#f85149');
                document.querySelectorAll('.role-mvd').forEach(el => el.style.display = 'none');
                document.getElementById('ui-dept').innerText = "EMS / FIRE DEPT";
                document.getElementById('ui-dept').style.color = "#f85149";
            }

            document.getElementById('ui-name').innerText = name;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('app-interface').style.display = 'grid';
            
            playSound('boot');
            showToast(`Добро пожаловать, ${name}`, 'info');
            addToArchive("Начало смены. Вход в систему.");
        }

        // --- NAVIGATION ---
        function openModule(id) {
            playSound('click');
            document.querySelectorAll('.module-page').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('nav li').forEach(l => l.classList.remove('active'));
            
            document.getElementById('mod-' + id).classList.add('active');
            // Hacky active class toggle for list items
            const navMap = {
                'dashboard': 0, 'protocols': 1, 'search': 2, 'vehicles': 3,
                'medical': 4, 'beds': 5, 'database': 6, 'archive': 7
            };
            // В реальном коде лучше через ID, тут упрощено
        }

        function setStatus(btn, text) {
            document.querySelectorAll('.status-btn').forEach(b => b.classList.remove('active', 'busy'));
            btn.classList.add(text === 'ЗАНЯТ' ? 'busy' : 'active');
            showToast(`Статус обновлен: ${text}`);
            addToArchive(`Смена статуса: ${text}`);
        }

        // --- MVD LOGIC ---
        function toggleLaw(div, law) {
            if(SELECTED_LAWS.includes(law)) {
                SELECTED_LAWS = SELECTED_LAWS.filter(l => l !== law);
                div.classList.remove('selected');
            } else {
                SELECTED_LAWS.push(law);
                div.classList.add('selected');
            }
            calculatePunishment();
        }

        function calculatePunishment() {
            let totalFine = 0;
            let totalTime = 0;
            SELECTED_LAWS.forEach(l => {
                totalFine += l.fine;
                totalTime += l.time;
            });
            document.getElementById('prot-result').value = `Штраф: ${totalFine}$ | Срок: ${totalTime} мес.`;
        }

        function submitProtocol() {
            const name = document.getElementById('prot-name').value;
            if(!name || SELECTED_LAWS.length === 0) {
                alert("Заполните имя и выберите статьи!");
                return;
            }
            const articles = SELECTED_LAWS.map(l => l.code + " " + l.id).join(", ");
            const punishment = document.getElementById('prot-result').value;
            
            addToArchive(`ПРОТОКОЛ: ${name}. Статьи: ${articles}. ${punishment}`);
            showToast("Протокол успешно загружен в базу", "success");
            
            // Clear form
            document.getElementById('prot-name').value = "";
            document.getElementById('prot-desc').value = "";
            SELECTED_LAWS = [];
            document.querySelectorAll('.law-item').forEach(el => el.classList.remove('selected'));
            document.getElementById('prot-result').value = "";
            
            // Update Stats
            let count = parseInt(document.getElementById('stat-reports').innerText);
            document.getElementById('stat-reports').innerText = count + 1;
        }

        function searchCitizen() {
            const query = document.getElementById('search-db-input').value.toLowerCase();
            const container = document.getElementById('search-results');
            container.innerHTML = "";
            
            if(query.length < 2) return;

            const results = MOCK_CITIZENS.filter(c => c.name.toLowerCase().includes(query));
            
            if(results.length === 0) {
                container.innerHTML = "<div style='padding:20px; color:#555'>Совпадений не найдено</div>";
                return;
            }

            results.forEach(c => {
                let badgeClass = c.status === 'WANTED' ? 'badge-red' : (c.status === 'CLEAN' ? 'badge-green' : 'badge-blue');
                let html = `
                    <div class="card" style="border-left: 5px solid ${c.status === 'WANTED' ? 'red' : 'green'}">
                        <div style="display:flex; justify-content:space-between;">
                            <h3>${c.name} <span class="badge ${badgeClass}">${c.status}</span></h3>
                            <span>Лицензии: ${c.lic}</span>
                        </div>
                        <p style="color:var(--text-muted)">${c.note}</p>
                        <button class="btn-main" style="width:auto; font-size:12px; padding:5px 10px;">Открыть полное досье</button>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        // --- EMS LOGIC ---
        function submitMedical() {
            const name = document.getElementById('med-name').value;
            const triage = document.getElementById('med-triage').value;
            
            if(!name) return;

            let color = "white";
            if(triage === 'green') color = "#3fb950";
            if(triage === 'yellow') color = "#d29922";
            if(triage === 'red') color = "#f85149";

            const table = document.getElementById('med-table-body');
            const row = `<tr>
                <td>${name}</td>
                <td><span class="badge" style="background:${color}; color:black;">${triage.toUpperCase()} CODE</span></td>
                <td>${new Date().toLocaleTimeString()}</td>
            </tr>`;
            
            table.innerHTML += row;
            addToArchive(`ГОСПИТАЛИЗАЦИЯ: ${name} (Код: ${triage})`);
            showToast("Пациент зарегистрирован");
        }

        // --- SYSTEM UTILS ---
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString();
            setTimeout(updateClock, 1000);
        }

        function addRandomFeed() {
            const messages = [
                "10-55, Черный седан, район Миррор-Парк",
                "Диспетчер: Всем юнитам, код 3, ограбление банка!",
                "Поступил вызов: Пожар в жилом доме",
                "Система: Обновление базы данных розыска...",
                "Внимание: План перехват на шоссе Сенора"
            ];
            const msg = messages[Math.floor(Math.random() * messages.length)];
            const feed = document.getElementById('live-feed');
            feed.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${msg}</div>` + feed.innerHTML;
        }

        function addToArchive(text) {
            const time = new Date().toLocaleTimeString();
            SESSION_LOGS.push(`[${time}] ${text}`);
            
            const container = document.getElementById('archive-content');
            container.innerHTML = SESSION_LOGS.map(l => `<div style="padding:5px; border-bottom:1px solid #333;">${l}</div>`).join('');
        }

        function showToast(text, type='info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<i class="fas fa-info-circle"></i> ${text}`;
            container.appendChild(toast);
            
            playSound('alert');

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function copyReport() {
            const text = SESSION_LOGS.join('\n');
            navigator.clipboard.writeText(text);
            showToast("Отчет скопирован в буфер обмена!");
        }
    </script>
</body>
</html>
