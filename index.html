<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERMINAL // STATE NETWORK v1.0</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        body {
            background-color: #0a0a0a;
            color: #00ff00;
            height: 100vh;
            overflow: hidden;
            position: relative;
        }

        /* Эффект сканирования */
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(to bottom, transparent, #00ff00 50%, transparent);
            animation: scan 4s linear infinite;
            z-index: 1000;
            pointer-events: none;
            opacity: 0.3;
        }

        @keyframes scan {
            0% { top: 0%; }
            100% { top: 100%; }
        }

        /* Экран загрузки */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .loading-text {
            font-size: 1.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 5px #00ff00;
        }

        .loading-bar {
            width: 300px;
            height: 4px;
            background-color: #003300;
            border: 1px solid #00aa00;
            overflow: hidden;
        }

        .loading-progress {
            height: 100%;
            width: 0%;
            background-color: #00ff00;
            animation: loading 2s ease-in-out forwards;
        }

        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }

        /* Экран входа */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1500;
        }

        .login-title {
            font-size: 2rem;
            margin-bottom: 40px;
            text-align: center;
            text-shadow: 0 0 10px #00ff00;
        }

        .login-box {
            border: 2px solid #00aa00;
            padding: 30px;
            background-color: #001100;
            width: 90%;
            max-width: 400px;
        }

        .login-input {
            margin-bottom: 20px;
        }

        .login-input label {
            display: block;
            margin-bottom: 5px;
            color: #00cc00;
        }

        .login-input input {
            width: 100%;
            padding: 10px;
            background-color: #000;
            border: 1px solid #00aa00;
            color: #00ff00;
            font-size: 1rem;
        }

        .login-input input:focus {
            outline: none;
            border-color: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .department-select {
            margin-bottom: 25px;
        }

        .department-select label {
            display: block;
            margin-bottom: 10px;
            color: #00cc00;
        }

        .dept-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .dept-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px;
            background-color: #002200;
            border: 1px solid #007700;
            color: #00cc00;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .dept-btn:hover, .dept-btn.active {
            background-color: #004400;
            border-color: #00ff00;
            color: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background-color: #003300;
            border: 1px solid #00aa00;
            color: #00ff00;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .login-btn:hover {
            background-color: #005500;
            border-color: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }

        /* Главный интерфейс */
        #main-interface {
            display: none;
            width: 100%;
            height: 100%;
        }

        /* Шапка терминала */
        .terminal-header {
            background-color: #001100;
            border-bottom: 2px solid #00aa00;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .terminal-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 0 0 5px #00ff00;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-dept {
            padding: 5px 10px;
            background-color: #003300;
            border: 1px solid #00aa00;
            border-radius: 3px;
        }

        .clock {
            font-size: 1.2rem;
            color: #00cc00;
        }

        .logout-btn {
            padding: 5px 15px;
            background-color: #330000;
            border: 1px solid #aa0000;
            color: #ff6666;
            cursor: pointer;
        }

        .logout-btn:hover {
            background-color: #550000;
            border-color: #ff0000;
        }

        /* Рабочая область */
        .workspace {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Боковое меню */
        .side-menu {
            width: 70px;
            background-color: #001a00;
            border-right: 1px solid #005500;
            padding-top: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .menu-item {
            width: 50px;
            height: 50px;
            margin-bottom: 20px;
            background-color: #003300;
            border: 1px solid #007700;
            color: #00cc00;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .menu-item:hover, .menu-item.active {
            background-color: #005500;
            border-color: #00ff00;
            color: #00ff00;
            transform: scale(1.1);
        }

        .menu-item .tooltip {
            position: absolute;
            left: 60px;
            background-color: #002200;
            border: 1px solid #00aa00;
            padding: 5px 10px;
            white-space: nowrap;
            display: none;
            z-index: 100;
        }

        .menu-item:hover .tooltip {
            display: block;
        }

        /* Основная область */
        .main-area {
            flex: 1;
            padding: 20px;
            background-color: #000;
            position: relative;
            overflow: auto;
        }

        /* Окно базы данных */
        .window {
            border: 2px solid #00aa00;
            background-color: #000;
            display: none;
            flex-direction: column;
            position: absolute;
            min-width: 600px;
            min-height: 400px;
            box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
        }

        .window.active {
            display: flex;
        }

        .window-header {
            background-color: #002200;
            padding: 8px 15px;
            border-bottom: 1px solid #00aa00;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
        }

        .window-title {
            font-weight: bold;
            color: #00ff00;
        }

        .window-controls {
            display: flex;
            gap: 10px;
        }

        .window-btn {
            width: 20px;
            height: 20px;
            background-color: #003300;
            border: 1px solid #007700;
            color: #00cc00;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 12px;
        }

        .window-btn:hover {
            background-color: #005500;
            border-color: #00ff00;
        }

        .window-content {
            flex: 1;
            padding: 15px;
            overflow: auto;
        }

        /* Стили для базы данных */
        .db-search {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }

        .db-search input {
            flex: 1;
            padding: 10px;
            background-color: #000;
            border: 1px solid #00aa00;
            color: #00ff00;
        }

        .db-search button {
            padding: 10px 20px;
            background-color: #003300;
            border: 1px solid #00aa00;
            color: #00ff00;
            cursor: pointer;
        }

        .db-search button:hover {
            background-color: #005500;
        }

        .db-table {
            width: 100%;
            border-collapse: collapse;
        }

        .db-table th {
            background-color: #002200;
            border: 1px solid #007700;
            padding: 10px;
            text-align: left;
        }

        .db-table td {
            border: 1px solid #007700;
            padding: 10px;
        }

        .db-table tr:hover {
            background-color: #002a00;
        }

        .status-wanted {
            color: #ff5555;
            font-weight: bold;
        }

        .status-clean {
            color: #55ff55;
        }

        .action-btn {
            padding: 5px 10px;
            margin-right: 5px;
            background-color: #003300;
            border: 1px solid #007700;
            color: #00cc00;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background-color: #005500;
            border-color: #00ff00;
        }

        /* Командная строка */
        .cmd-terminal {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 400px;
            height: 200px;
            background-color: rgba(0, 20, 0, 0.9);
            border: 1px solid #00aa00;
            display: none;
            flex-direction: column;
        }

        .cmd-header {
            background-color: #002200;
            padding: 5px 10px;
            border-bottom: 1px solid #00aa00;
            display: flex;
            justify-content: space-between;
        }

        .cmd-content {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            font-size: 0.9rem;
        }

        .cmd-input {
            display: flex;
            border-top: 1px solid #00aa00;
        }

        .cmd-prompt {
            padding: 5px 10px;
            background-color: #001100;
            color: #00ff00;
        }

        .cmd-input input {
            flex: 1;
            padding: 5px;
            background-color: transparent;
            border: none;
            color: #00ff00;
            outline: none;
        }

        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px;
            background-color: #002200;
            border: 1px solid #00aa00;
            color: #00ff00;
            max-width: 300px;
            display: none;
            z-index: 1000;
        }

        .notification.show {
            display: block;
            animation: fadeInOut 5s ease-in-out;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(100px); }
            10% { opacity: 1; transform: translateX(0); }
            90% { opacity: 1; transform: translateX(0); }
            100% { opacity: 0; transform: translateX(100px); }
        }
    </style>
</head>
<body>
    <!-- Эффект сканирования -->
    <div class="scan-line"></div>

    <!-- Экран загрузки -->
    <div id="loading-screen">
        <div class="loading-text">ИНИЦИАЛИЗАЦИЯ СИСТЕМЫ STATE NETWORK</div>
        <div class="loading-bar">
            <div class="loading-progress"></div>
        </div>
        <div style="margin-top: 20px; color: #00aa00; font-size: 0.9rem;">
            Загрузка модулей безопасности...
        </div>
    </div>

    <!-- Экран входа -->
    <div id="login-screen">
        <div class="login-title">TERMINAL // ГОСУДАРСТВЕННАЯ СЕТЬ</div>
        <div class="login-box">
            <div class="department-select">
                <label>ВЫБЕРИТЕ ПОДРАЗДЕЛЕНИЕ:</label>
                <div class="dept-buttons">
                    <div class="dept-btn" data-dept="ПОЛИЦИЯ">ПОЛИЦИЯ</div>
                    <div class="dept-btn" data-dept="СКОРАЯ ПОМОЩЬ">СКОРАЯ ПОМОЩЬ</div>
                    <div class="dept-btn" data-dept="ПОЖАРНАЯ СЛУЖБА">ПОЖАРНАЯ СЛУЖБА</div>
                    <div class="dept-btn" data-dept="ДПС">ДПС</div>
                    <div class="dept-btn" data-dept="ФСБ">ФСБ</div>
                </div>
            </div>
            <div class="login-input">
                <label>ИДЕНТИФИКАТОР СОТРУДНИКА:</label>
                <input type="text" id="login-id" placeholder="Введите ваш ID" value="OFFICER-731">
            </div>
            <div class="login-input">
                <label>КОД ДОСТУПА:</label>
                <input type="password" id="login-password" placeholder="Введите пароль" value="••••••••">
            </div>
            <button class="login-btn" id="login-button">ПОДКЛЮЧИТЬСЯ К СЕТИ</button>
        </div>
        <div style="margin-top: 30px; color: #007700; font-size: 0.8rem; text-align: center;">
            ВНИМАНИЕ: Все действия в системе протоколируются.<br>
            Несанкционированный доступ преследуется по закону.
        </div>
    </div>

    <!-- Главный интерфейс -->
    <div id="main-interface">
        <div class="terminal-header">
            <div class="terminal-title">STATE NETWORK // ТЕРМИНАЛ ДОСТУПА</div>
            <div class="user-info">
                <div class="user-dept" id="current-dept">ПОЛИЦИЯ</div>
                <div class="clock" id="clock">00:00:00</div>
                <button class="logout-btn" id="logout-button">ЗАВЕРШИТЬ СЕАНС</button>
            </div>
        </div>

        <div class="workspace">
            <!-- Боковое меню -->
            <div class="side-menu">
                <div class="menu-item active" data-window="db">
                    <i class="fas fa-database"></i>
                    <div class="tooltip">БАЗА ДАННЫХ</div>
                </div>
                <div class="menu-item" data-window="calls">
                    <i class="fas fa-phone-alt"></i>
                    <div class="tooltip">ВЫЗОВЫ</div>
                </div>
                <div class="menu-item" data-window="fines">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <div class="tooltip">ШТРАФЫ</div>
                </div>
                <div class="menu-item" data-window="duty">
                    <i class="fas fa-user-clock"></i>
                    <div class="tooltip">СЛУЖБА</div>
                </div>
                <div class="menu-item" data-window="reports">
                    <i class="fas fa-chart-bar"></i>
                    <div class="tooltip">ОТЧЕТЫ</div>
                </div>
                <div class="menu-item" id="cmd-toggle">
                    <i class="fas fa-terminal"></i>
                    <div class="tooltip">ТЕРМИНАЛ</div>
                </div>
            </div>

            <!-- Основная область с окнами -->
            <div class="main-area" id="workspace-area">
                <!-- Окно базы данных -->
                <div class="window active" id="window-db" style="width: 800px; height: 500px; left: 50px; top: 30px;">
                    <div class="window-header">
                        <div class="window-title"><i class="fas fa-database"></i> ГОСУДАРСТВЕННАЯ БАЗА ДАННЫХ ГРАЖДАН</div>
                        <div class="window-controls">
                            <div class="window-btn" data-action="minimize">—</div>
                            <div class="window-btn" data-action="maximize">□</div>
                            <div class="window-btn" data-action="close">×</div>
                        </div>
                    </div>
                    <div class="window-content">
                        <div class="db-search">
                            <input type="text" id="search-input" placeholder="Поиск по ФИО, ID или номеру лицензии...">
                            <button id="search-btn"><i class="fas fa-search"></i> ПОИСК</button>
                            <button id="add-citizen-btn"><i class="fas fa-user-plus"></i> ДОБАВИТЬ</button>
                        </div>
                        
                        <table class="db-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>ФИО</th>
                                    <th>ЛИЦЕНЗИИ</th>
                                    <th>СТАТУС</th>
                                    <th>ШТРАФЫ</th>
                                    <th>ДЕЙСТВИЯ</th>
                                </tr>
                            </thead>
                            <tbody id="db-table-body">
                                <!-- Данные будут заполнены через JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Окно вызовов (пока скрыто) -->
                <div class="window" id="window-calls" style="width: 700px; height: 450px; left: 100px; top: 50px;">
                    <div class="window-header">
                        <div class="window-title"><i class="fas fa-phone-alt"></i> АКТИВНЫЕ ВЫЗОВЫ И ЗАЯВЛЕНИЯ</div>
                        <div class="window-controls">
                            <div class="window-btn" data-action="minimize">—</div>
                            <div class="window-btn" data-action="maximize">□</div>
                            <div class="window-btn" data-action="close">×</div>
                        </div>
                    </div>
                    <div class="window-content">
                        <p>Здесь будет список вызовов и заявлений...</p>
                    </div>
                </div>

                <!-- Окно штрафов (пока скрыто) -->
                <div class="window" id="window-fines" style="width: 750px; height: 400px; left: 150px; top: 80px;">
                    <div class="window-header">
                        <div class="window-title"><i class="fas fa-file-invoice-dollar"></i> СИСТЕМА УЧЕТА ШТРАФОВ</div>
                        <div class="window-controls">
                            <div class="window-btn" data-action="minimize">—</div>
                            <div class="window-btn" data-action="maximize">□</div>
                            <div class="window-btn" data-action="close">×</div>
                        </div>
                    </div>
                    <div class="window-content">
                        <p>Здесь будет система выписки штрафов...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Командная строка -->
    <div class="cmd-terminal" id="cmd-terminal">
        <div class="cmd-header">
            <div>ТЕРМИНАЛ // АДМИНИСТРАТИВНЫЙ ДОСТУП</div>
            <div class="window-btn" style="width: 15px; height: 15px;" id="cmd-close">×</div>
        </div>
        <div class="cmd-content" id="cmd-output">
            > Добро пожаловать в административный терминал.<br>
            > Введите 'help' для списка команд.<br><br>
        </div>
        <div class="cmd-input">
            <div class="cmd-prompt">> </div>
            <input type="text" id="cmd-input" autocomplete="off">
        </div>
    </div>

    <!-- Уведомления -->
    <div class="notification" id="notification">
        <div id="notification-text">Уведомление</div>
    </div>

    <script>
        // Тестовые данные для базы данных
        const citizens = [
            { id: 1, name: "Иванов_Иван_Петрович", licenses: "A, B", status: "clean", fines: 0 },
            { id: 2, name: "Петров_Алексей_Сергеевич", licenses: "A, B, C", status: "wanted", fines: 12500 },
            { id: 3, name: "Сидорова_Мария_Владимировна", licenses: "A", status: "clean", fines: 3500 },
            { id: 4, name: "Кузнецов_Дмитрий_Алексеевич", licenses: "B", status: "suspended", fines: 8000 },
            { id: 5, name: "Смирнов_Андрей_Игоревич", licenses: "A, B, D", status: "clean", fines: 0 },
            { id: 6, name: "Федорова_Екатерина_Олеговна", licenses: "A", status: "clean", fines: 1500 },
            { id: 7, name: "Морозов_Павел_Витальевич", licenses: "B, C", status: "wanted", fines: 22000 },
            { id: 8, name: "Волкова_Ольга_Дмитриевна", licenses: "A, B", status: "clean", fines: 0 },
            { id: 9, name: "Новиков_Сергей_Анатольевич", licenses: "A, C", status: "suspended", fines: 5000 },
            { id: 10, name: "Лебедева_Анна_Сергеевна", licenses: "B", status: "clean", fines: 700 }
        ];

        // Текущее состояние системы
        let currentDept = "ПОЛИЦИЯ";
        let currentOfficer = "OFFICER-731";
        let activeWindow = "db";
        let draggedWindow = null;
        let dragOffset = { x: 0, y: 0 };

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            // Имитация загрузки системы
            setTimeout(() => {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
            }, 2000);

            // Инициализация часов
            updateClock();
            setInterval(updateClock, 1000);

            // Инициализация базы данных
            populateDatabase();

            // Настройка событий
            setupEventListeners();
        });

        // Функция обновления времени
        function updateClock() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ru-RU');
            document.getElementById('clock').textContent = timeString;
        }

        // Заполнение таблицы базы данных
        function populateDatabase() {
            const tbody = document.getElementById('db-table-body');
            tbody.innerHTML = '';

            citizens.forEach(citizen => {
                const row = document.createElement('tr');
                
                let statusText, statusClass;
                if (citizen.status === 'wanted') {
                    statusText = 'В РОЗЫСКЕ';
                    statusClass = 'status-wanted';
                } else if (citizen.status === 'suspended') {
                    statusText = 'ЛИШЕН ПРАВ';
                    statusClass = 'status-wanted';
                } else {
                    statusText = 'ЧИСТ';
                    statusClass = 'status-clean';
                }

                row.innerHTML = `
                    <td>${citizen.id}</td>
                    <td>${citizen.name}</td>
                    <td>${citizen.licenses}</td>
                    <td class="${statusClass}">${statusText}</td>
                    <td>${citizen.fines} руб.</td>
                    <td>
                        <button class="action-btn" onclick="showCitizenDetails(${citizen.id})">ПРОСМОТР</button>
                        <button class="action-btn" onclick="issueFine(${citizen.id})">ШТРАФ</button>
                        ${citizen.status === 'wanted' ? 
                          `<button class="action-btn" style="background-color: #550000; border-color: #ff0000;" onclick="removeWanted(${citizen.id})">СНЯТЬ РОЗЫСК</button>` : 
                          `<button class="action-btn" style="background-color: #330000; border-color: #aa0000;" onclick="setWanted(${citizen.id})">ОБЪЯВИТЬ В РОЗЫСК</button>`}
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Настройка всех обработчиков событий
        function setupEventListeners() {
            // Выбор подразделения
            document.querySelectorAll('.dept-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.dept-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentDept = this.getAttribute('data-dept');
                });
            });

            // Кнопка входа
            document.getElementById('login-button').addEventListener('click', login);

            // Поле пароля - Enter для входа
            document.getElementById('login-password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });

            // Кнопка выхода
            document.getElementById('logout-button').addEventListener('click', logout);

            // Меню боковой панели
            document.querySelectorAll('.menu-item[data-window]').forEach(item => {
                item.addEventListener('click', function() {
                    const windowId = this.getAttribute('data-window');
                    switchWindow(windowId);
                });
            });

            // Переключение терминала
            document.getElementById('cmd-toggle').addEventListener('click', toggleTerminal);
            document.getElementById('cmd-close').addEventListener('click', toggleTerminal);

            // Командная строка
            document.getElementById('cmd-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processCommand(this.value);
                    this.value = '';
                }
            });

            // Поиск в БД
            document.getElementById('search-btn').addEventListener('click', searchDatabase);
            document.getElementById('search-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') searchDatabase();
            });

            // Добавление гражданина
            document.getElementById('add-citizen-btn').addEventListener('click', addCitizen);

            // Управление окнами
            setupWindowControls();
        }

        // Функция входа в систему
        function login() {
            const officerId = document.getElementById('login-id').value;
            
            if (!officerId.trim()) {
                showNotification('Ошибка: Введите идентификатор сотрудника');
                return;
            }

            currentOfficer = officerId;
            
            // Скрываем экран входа
            document.getElementById('login-screen').style.display = 'none';
            
            // Показываем главный интерфейс
            document.getElementById('main-interface').style.display = 'block';
            document.getElementById('current-dept').textContent = currentDept;
            
            showNotification(`Добро пожаловать, ${officerId}. Подключение к ${currentDept} установлено.`);
        }

        // Функция выхода из системы
        function logout() {
            if (confirm('Завершить текущий сеанс работы?')) {
                document.getElementById('main-interface').style.display = 'none';
                document.getElementById('login-screen').style.display = 'flex';
                showNotification(`Сеанс пользователя ${currentOfficer} завершен.`);
            }
        }

        // Переключение между окнами
        function switchWindow(windowId) {
            // Скрыть все окна
            document.querySelectorAll('.window').forEach(window => {
                window.classList.remove('active');
            });
            
            // Показать выбранное окно
            document.getElementById(`window-${windowId}`).classList.add('active');
            
            // Обновить активную кнопку в меню
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.menu-item[data-window="${windowId}"]`).classList.add('active');
            
            activeWindow = windowId;
        }

        // Переключение терминала
        function toggleTerminal() {
            const terminal = document.getElementById('cmd-terminal');
            terminal.style.display = terminal.style.display === 'flex' ? 'none' : 'flex';
            if (terminal.style.display === 'flex') {
                document.getElementById('cmd-input').focus();
            }
        }

        // Обработка команд в терминале
        function processCommand(cmd) {
            const output = document.getElementById('cmd-output');
            output.innerHTML += `> ${cmd}<br>`;
            
            cmd = cmd.trim().toLowerCase();
            
            if (cmd === 'help' || cmd === '?') {
                output.innerHTML += `Доступные команды:<br>
                - help - показать это сообщение<br>
                - clear - очистить терминал<br>
                - status - статус системы<br>
                - time - текущее время<br>
                - dept - текущее подразделение<br>
                - user - текущий пользователь<br>
                - scan [id] - проверить гражданина по ID<br>
                - wanted [id] - объявить в розыск<br><br>`;
            } 
            else if (cmd === 'clear') {
                output.innerHTML = '';
            }
            else if (cmd === 'status') {
                output.innerHTML += `Статус: ОПЕРАТИВНЫЙ<br>
                Подразделение: ${currentDept}<br>
                Пользователь: ${currentOfficer}<br>
                Активное окно: ${activeWindow}<br><br>`;
            }
            else if (cmd === 'time') {
                const now = new Date();
                output.innerHTML += `Текущее время: ${now.toLocaleTimeString('ru-RU')}<br><br>`;
            }
            else if (cmd === 'dept') {
                output.innerHTML += `Текущее подразделение: ${currentDept}<br><br>`;
            }
            else if (cmd === 'user') {
                output.innerHTML += `Текущий пользователь: ${currentOfficer}<br><br>`;
            }
            else if (cmd.startsWith('scan ')) {
                const id = parseInt(cmd.substring(5));
                const citizen = citizens.find(c => c.id === id);
                if (citizen) {
                    output.innerHTML += `Результат сканирования ID ${id}:<br>
                    ФИО: ${citizen.name}<br>
                    Лицензии: ${citizen.licenses}<br>
                    Статус: ${citizen.status === 'wanted' ? 'В РОЗЫСКЕ' : 'ЧИСТ'}<br>
                    Штрафы: ${citizen.fines} руб.<br><br>`;
                } else {
                    output.innerHTML += `Гражданин с ID ${id} не найден.<br><br>`;
                }
            }
            else if (cmd.startsWith('wanted ')) {
                const id = parseInt(cmd.substring(7));
                const citizen = citizens.find(c => c.id === id);
                if (citizen) {
                    citizen.status = 'wanted';
                    populateDatabase();
                    output.innerHTML += `Гражданин ${citizen.name} объявлен в розыск.<br><br>`;
                    showNotification(`Гражданин ${citizen.name} объявлен в розыск!`);
                } else {
                    output.innerHTML += `Гражданин с ID ${id} не найден.<br><br>`;
                }
            }
            else if (cmd === '') {
                // Пустая команда - ничего не делаем
            }
            else {
                output.innerHTML += `Неизвестная команда: "${cmd}". Введите "help" для справки.<br><br>`;
            }
            
            // Прокрутка вниз
            output.scrollTop = output.scrollHeight;
        }

        // Поиск в базе данных
        function searchDatabase() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const tbody = document.getElementById('db-table-body');
            const rows = tbody.querySelectorAll('tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
            
            if (query) {
                showNotification(`Поиск выполнен. Найдено ${Array.from(rows).filter(r => r.style.display !== 'none').length} записей.`);
            }
        }

        // Добавление нового гражданина
        function addCitizen() {
            const name = prompt('Введите ФИО нового гражданина:');
            if (name) {
                const newId = citizens.length > 0 ? Math.max(...citizens.map(c => c.id)) + 1 : 1;
                citizens.push({
                    id: newId,
                    name: name,
                    licenses: "A",
                    status: "clean",
                    fines: 0
                });
                populateDatabase();
                showNotification(`Гражданин ${name} добавлен в базу данных. ID: ${newId}`);
            }
        }

        // Функции для кнопок действий
        function showCitizenDetails(id) {
            const citizen = citizens.find(c => c.id === id);
            if (citizen) {
                alert(`ДЕТАЛИ ГРАЖДАНИНА:\n\nID: ${citizen.id}\nФИО: ${citizen.name}\nЛицензии: ${citizen.licenses}\nСтатус: ${citizen.status === 'wanted' ? 'В РОЗЫСКЕ' : citizen.status === 'suspended' ? 'ЛИШЕН ПРАВ' : 'ЧИСТ'}\nНакопленные штрафы: ${citizen.fines} руб.`);
            }
        }

        function issueFine(id) {
            const citizen = citizens.find(c => c.id === id);
            if (citizen) {
                const amount = prompt(`Выписать штраф для ${citizen.name}:\nТекущий долг: ${citizen.fines} руб.`, "1000");
                if (amount && !isNaN(amount)) {
                    citizen.fines += parseInt(amount);
                    populateDatabase();
                    showNotification(`Гражданину ${citizen.name} выписан штраф ${amount} руб. Общий долг: ${citizen.fines} руб.`);
                }
            }
        }

        function setWanted(id) {
            const citizen = citizens.find(c => c.id === id);
            if (citizen && confirm(`Объявить гражданина ${citizen.name} в розыск?`)) {
                citizen.status = 'wanted';
                populateDatabase();
                showNotification(`ГРАЖДАНИН ${citizen.name} ОБЪЯВЛЕН В РОЗЫСК!`, true);
            }
        }

        function removeWanted(id) {
            const citizen = citizens.find(c => c.id === id);
            if (citizen && confirm(`Снять гражданина ${citizen.name} с розыска?`)) {
                citizen.status = 'clean';
                populateDatabase();
                showNotification(`Гражданин ${citizen.name} снят с розыска.`);
            }
        }

        // Настройка управления окнами (перетаскивание, кнопки)
        function setupWindowControls() {
            // Обработчики для кнопок окон
            document.querySelectorAll('.window-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    const window = this.closest('.window');
                    
                    if (action === 'minimize') {
                        window.style.display = 'none';
                    } else if (action === 'maximize') {
                        if (window.style.width === '90vw' && window.style.height === '90vh') {
                            window.style.width = '';
                            window.style.height = '';
                            window.style.left = '';
                            window.style.top = '';
                        } else {
                            window.style.width = '90vw';
                            window.style.height = '90vh';
                            window.style.left = '5%';
                            window.style.top = '5%';
                        }
                    } else if (action === 'close') {
                        if (window.id === 'window-db') {
                            alert('Окно базы данных нельзя закрыть. Используйте кнопку свернуть.');
                        } else {
                            window.style.display = 'none';
                        }
                    }
                });
            });

            // Перетаскивание окон
            document.querySelectorAll('.window-header').forEach(header => {
                header.addEventListener('mousedown', startDrag);
            });

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
        }

        function startDrag(e) {
            if (e.target.classList.contains('window-btn')) return;
            
            draggedWindow = e.target.closest('.window');
            const rect = draggedWindow.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            draggedWindow.style.zIndex = 100;
        }

        function drag(e) {
            if (!draggedWindow) return;
            
            draggedWindow.style.left = (e.clientX - dragOffset.x) + 'px';
            draggedWindow.style.top = (e.clientY - dragOffset.y) + 'px';
        }

        function stopDrag() {
            if (draggedWindow) {
                draggedWindow.style.zIndex = 1;
                draggedWindow = null;
            }
        }

        // Показать уведомление
        function showNotification(message, isImportant = false) {
            const notification = document.getElementById('notification');
            document.getElementById('notification-text').textContent = message;
            
            if (isImportant) {
                notification.style.backgroundColor = '#330000';
                notification.style.borderColor = '#ff0000';
                notification.style.color = '#ffaaaa';
            } else {
                notification.style.backgroundColor = '#002200';
                notification.style.borderColor = '#00aa00';
                notification.style.color = '#00ff00';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Экспортируем функции для использования в HTML
        window.showCitizenDetails = showCitizenDetails;
        window.issueFine = issueFine;
        window.setWanted = setWanted;
        window.removeWanted = removeWanted;
    </script>
</body>
</html>
