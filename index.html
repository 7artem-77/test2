<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OMEGA GOV SYSTEM v5.0</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-deep: #050505;
            --bg-panel: #101010;
            --bg-surface: #1a1a1a;
            
            --border-light: #333;
            --border-focus: #555;

            /* MVD THEME (Default) */
            --accent: #3b82f6; 
            --accent-glow: rgba(59, 130, 246, 0.4);
            
            --text-main: #e5e5e5;
            --text-muted: #888;
            
            --status-ok: #10b981;
            --status-warn: #f59e0b;
            --status-danger: #ef4444;

            --font-ui: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        /* --- GLOBAL RESET --- */
        * { box-sizing: border-box; outline: none; user-select: none; }
        body {
            margin: 0; background: var(--bg-deep); color: var(--text-main);
            font-family: var(--font-ui); height: 100vh; overflow: hidden;
            display: flex; flex-direction: column;
        }
        
        /* SCROLLBARS */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--accent); }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .center { align-items: center; justify-content: center; }
        .col { flex-direction: column; }
        .gap-10 { gap: 10px; }
        .gap-20 { gap: 20px; }
        .bold { font-weight: 700; }
        
        .btn {
            background: var(--bg-surface); border: 1px solid var(--border-light);
            color: var(--text-main); padding: 8px 16px; border-radius: 4px;
            cursor: pointer; transition: 0.2s; font-size: 0.9rem;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn:hover { border-color: var(--accent); color: var(--accent); }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: #fff; }
        .btn-primary:hover { filter: brightness(1.1); color: #fff; box-shadow: 0 0 15px var(--accent-glow); }
        
        .input {
            background: #000; border: 1px solid var(--border-light); color: #fff;
            padding: 10px; border-radius: 4px; width: 100%; font-family: inherit;
        }
        .input:focus { border-color: var(--accent); }

        /* --- LOGIN SCREEN --- */
        #login-overlay {
            position: fixed; inset: 0; z-index: 9999;
            background: #000;
            background-image: radial-gradient(circle at center, #111 0%, #000 70%);
        }
        .login-box {
            width: 400px; padding: 40px; background: rgba(20,20,20,0.9);
            border: 1px solid #333; border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.8); backdrop-filter: blur(10px);
        }

        /* --- MAIN LAYOUT --- */
        #app { display: flex; height: 100%; width: 100%; opacity: 0; transition: opacity 1s; }
        
        /* SIDEBAR */
        aside {
            width: 260px; background: var(--bg-panel); border-right: 1px solid var(--border-light);
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .profile-sec { padding: 20px; border-bottom: 1px solid var(--border-light); background: rgba(255,255,255,0.02); }
        .nav-menu { flex: 1; padding: 10px; overflow-y: auto; }
        .nav-item {
            padding: 12px 15px; margin-bottom: 5px; border-radius: 6px;
            color: var(--text-muted); cursor: pointer; transition: 0.2s;
            display: flex; align-items: center; gap: 12px; font-weight: 500;
        }
        .nav-item:hover { background: rgba(255,255,255,0.05); color: #fff; }
        .nav-item.active { background: var(--accent); color: #fff; box-shadow: 0 4px 12px var(--accent-glow); }

        /* CENTER CONTENT */
        main { flex: 1; display: flex; flex-direction: column; overflow: hidden; position: relative; }
        
        header {
            height: 60px; background: var(--bg-panel); border-bottom: 1px solid var(--border-light);
            display: flex; align-items: center; justify-content: space-between; padding: 0 20px;
        }
        .top-stat { font-family: var(--font-mono); font-size: 0.85rem; color: var(--accent); }

        .workspace { padding: 20px; overflow-y: auto; height: 100%; background: var(--bg-deep); }
        
        /* RIGHT PANEL (RADIO) */
        .radio-panel {
            width: 280px; background: var(--bg-panel); border-left: 1px solid var(--border-light);
            display: flex; flex-direction: column; flex-shrink: 0;
        }
        .radio-feed { flex: 1; overflow-y: auto; padding: 10px; font-family: var(--font-mono); font-size: 0.75rem; }
        .radio-msg { margin-bottom: 8px; padding: 8px; background: rgba(0,0,0,0.3); border-left: 2px solid #333; }
        .radio-msg.priority { border-left-color: var(--status-danger); background: rgba(239, 68, 68, 0.1); }
        
        /* --- MODULES & CARDS --- */
        .module { display: none; animation: fadeIn 0.3s; }
        .module.active { display: block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:translateY(0)} }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }

        .card {
            background: var(--bg-surface); border: 1px solid var(--border-light);
            border-radius: 6px; padding: 20px; margin-bottom: 20px;
        }
        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; border-bottom: 1px solid var(--border-light); padding-bottom: 10px;
        }
        .card h3 { margin: 0; font-size: 1rem; color: var(--text-main); text-transform: uppercase; letter-spacing: 1px; }

        /* DB TABLES */
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { text-align: left; padding: 10px; color: var(--text-muted); border-bottom: 1px solid var(--border-light); }
        td { padding: 10px; border-bottom: 1px solid #222; }
        tr:hover td { background: rgba(255,255,255,0.02); cursor: pointer; }
        
        /* TAGS */
        .tag { padding: 2px 6px; border-radius: 3px; font-size: 0.7rem; font-weight: bold; }
        .tag-red { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .tag-green { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
        
        /* MAP PLACEHOLDER */
        .map-container {
            width: 100%; height: 400px; background: #0c0c0c;
            border: 1px solid var(--border-light); position: relative;
            background-image: 
                linear-gradient(rgba(20,20,20,0.8), rgba(20,20,20,0.8)),
                url('https://upload.wikimedia.org/wikipedia/commons/thumb/c/c5/Los_Angeles_map.png/640px-Los_Angeles_map.png');
            background-size: cover; background-position: center;
        }
        .blip {
            width: 8px; height: 8px; background: var(--accent); border-radius: 50%;
            position: absolute; box-shadow: 0 0 10px var(--accent);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 var(--accent-glow);} 70% {box-shadow: 0 0 0 10px transparent;} 100% {box-shadow: 0 0 0 0 transparent;} }

        /* MODAL */
        #modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 500;
            display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal-content {
            width: 600px; max-height: 80vh; overflow-y: auto; background: var(--bg-panel);
            border: 1px solid var(--border-light); border-radius: 8px; padding: 0;
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        .modal-header { padding: 20px; background: var(--bg-surface); border-bottom: 1px solid var(--border-light); display: flex; justify-content: space-between; }
        .modal-body { padding: 20px; }

    </style>
</head>
<body>

    <div id="login-overlay" class="flex center col">
        <div class="login-box">
            <h1 style="text-align: center; margin-bottom: 5px; color: var(--accent);">OMEGA <span style="font-weight:300; color:#fff;">SYSTEM</span></h1>
            <p style="text-align: center; color: var(--text-muted); margin-bottom: 30px; font-size: 0.8rem;">GOVERNMENT SECURE ACCESS v5.0</p>
            
            <label style="font-size: 0.8rem; color: #888;">ИДЕНТИФИКАЦИЯ</label>
            <input type="text" id="login-user" class="input" placeholder="Фамилия Инициалы" style="margin-bottom: 15px;">
            
            <label style="font-size: 0.8rem; color: #888;">ПОДРАЗДЕЛЕНИЕ</label>
            <select id="login-dept" class="input" style="margin-bottom: 25px;">
                <option value="LSPD">МВД (Полиция)</option>
                <option value="EMS">МЧС (Медицина)</option>
            </select>
            
            <button class="btn btn-primary" style="width: 100%; justify-content: center;" onclick="bootSystem()">ВОЙТИ В СЕТЬ</button>
        </div>
        <div style="margin-top: 20px; font-family: var(--font-mono); font-size: 0.7rem; color: #444;">
            AUTHORIZED PERSONNEL ONLY // CLASSIFIED
        </div>
    </div>

    <div id="app">
        <aside>
            <div class="profile-sec">
                <div style="font-size: 1.2rem; font-weight: bold;" id="ui-user">USER</div>
                <div style="font-size: 0.8rem; color: var(--accent);" id="ui-dept">DEPARTMENT</div>
                <div style="margin-top: 10px; display: flex; gap: 5px;">
                    <button class="btn" style="padding: 4px 8px; font-size: 0.7rem; background: var(--status-ok); color: #000; border:none;">10-8</button>
                    <button class="btn" style="padding: 4px 8px; font-size: 0.7rem; background: var(--status-warn); color: #000; border:none;">10-6</button>
                </div>
            </div>
            <nav class="nav-menu">
                <div class="nav-item active" onclick="nav('dash')"><i class="fas fa-chart-pie"></i> Главная</div>
                <div class="nav-item" onclick="nav('map')"><i class="fas fa-map-marked-alt"></i> Карта штата</div>
                
                <div class="mvd-only">
                    <div style="margin: 15px 0 5px 15px; font-size: 0.7rem; color: #555; font-weight: bold;">ПОЛИЦЕЙСКИЕ МОДУЛИ</div>
                    <div class="nav-item" onclick="nav('search')"><i class="fas fa-user-shield"></i> База Граждан</div>
                    <div class="nav-item" onclick="nav('vehicles')"><i class="fas fa-car"></i> Поиск Авто</div>
                    <div class="nav-item" onclick="nav('warrants')"><i class="fas fa-gavel"></i> Ордера / Розыск</div>
                    <div class="nav-item" onclick="nav('protocol')"><i class="fas fa-file-contract"></i> Протокол</div>
                </div>

                <div class="ems-only hidden">
                    <div style="margin: 15px 0 5px 15px; font-size: 0.7rem; color: #555; font-weight: bold;">МЕДИЦИНСКИЕ МОДУЛИ</div>
                    <div class="nav-item" onclick="nav('patients')"><i class="fas fa-procedures"></i> Реестр Пациентов</div>
                    <div class="nav-item" onclick="nav('calls')"><i class="fas fa-ambulance"></i> Активные Вызовы</div>
                </div>
                
                <div style="margin-top: auto;">
                    <div class="nav-item" onclick="location.reload()"><i class="fas fa-sign-out-alt"></i> Выход</div>
                </div>
            </nav>
        </aside>

        <main>
            <header>
                <div style="display:flex; gap: 20px; align-items: center;">
                    <i class="fas fa-shield-alt" style="font-size: 1.5rem; color: var(--accent);"></i>
                    <span style="font-weight: bold; letter-spacing: 1px;">GOV.OS <span style="opacity: 0.5;">v5.0</span></span>
                </div>
                <div class="flex center gap-20">
                    <span class="top-stat"><i class="fas fa-clock"></i> <span id="clock">12:00</span></span>
                    <span class="top-stat"><i class="fas fa-cloud"></i> +18°C</span>
                    <span class="top-stat" style="color: var(--status-ok);">● ONLINE</span>
                </div>
            </header>

            <div class="workspace">
                
                <div id="mod-dash" class="module active">
                    <div class="grid-4">
                        <div class="card" style="text-align: center;">
                            <h1 style="color: var(--accent); font-size: 2.5rem; margin: 0;">12</h1>
                            <div style="font-size: 0.8rem; color: #777;">АКТИВНЫЕ ЮНИТЫ</div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <h1 style="color: var(--status-danger); font-size: 2.5rem; margin: 0;">5</h1>
                            <div style="font-size: 0.8rem; color: #777;">КОД 3 (ВЫЗОВЫ)</div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <h1 style="color: #fff; font-size: 2.5rem; margin: 0;">142</h1>
                            <div style="font-size: 0.8rem; color: #777;">ПРОТОКОЛОВ ЗА 24Ч</div>
                        </div>
                        <div class="card" style="text-align: center;">
                            <h1 style="color: var(--status-warn); font-size: 2.5rem; margin: 0;">8</h1>
                            <div style="font-size: 0.8rem; color: #777;">В РОЗЫСКЕ</div>
                        </div>
                    </div>

                    <div class="grid-2">
                        <div class="card">
                            <div class="card-header"><h3><i class="fas fa-bullhorn"></i> ОРИЕНТИРОВКИ (BOLO)</h3></div>
                            <div id="bolo-list">
                                </div>
                        </div>
                        <div class="card">
                            <div class="card-header"><h3><i class="fas fa-newspaper"></i> НОВОСТИ ДЕПАРТАМЕНТА</h3></div>
                            <div style="font-size: 0.9rem; line-height: 1.5; color: #aaa;">
                                <p><span style="color: var(--accent);">[ВАЖНО]</span> Обновление протоколов задержания. Ознакомиться всем сотрудникам.</p>
                                <p><span style="color: #fff;">[ИНФО]</span> В районе Сэнди-Шорс замечена активность ОПГ.</p>
                                <p><span style="color: #fff;">[СИСТЕМА]</span> Технические работы на сервере 22.01 в 04:00.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="mod-map" class="module">
                    <div class="card">
                        <div class="card-header">
                            <h3>GPS ТРЕКЕР ЮНИТОВ</h3>
                            <div class="flex gap-10">
                                <span class="tag tag-green">ЮНИТЫ</span>
                                <span class="tag tag-red">ВЫЗОВЫ</span>
                            </div>
                        </div>
                        <div class="map-container" id="map-box">
                            </div>
                    </div>
                </div>

                <div id="mod-search" class="module">
                    <div class="card">
                        <div class="flex gap-10">
                            <input type="text" id="search-input" class="input" placeholder="Введите Имя, Фамилию или ID..." style="font-size: 1.1rem;">
                            <button class="btn btn-primary" onclick="performSearch()">ПОИСК</button>
                        </div>
                    </div>
                    <div id="search-results" class="grid-3">
                        </div>
                </div>

                <div id="mod-vehicles" class="module">
                    <div class="card">
                        <h3>ПОИСК ТРАНСПОРТНОГО СРЕДСТВА</h3>
                        <br>
                        <div class="flex gap-10">
                            <input type="text" id="veh-input" class="input" placeholder="Гос. номер (напр. 4X99)">
                            <button class="btn btn-primary" onclick="searchVehicle()">ПРОВЕРИТЬ</button>
                        </div>
                    </div>
                    <div id="veh-result"></div>
                </div>

                <div id="mod-protocol" class="module">
                    <div class="card">
                        <div class="card-header"><h3>СОСТАВЛЕНИЕ РАПОРТА</h3></div>
                        <div class="grid-2">
                            <div>
                                <label style="font-size:0.8rem; color:#888;">НАРУШИТЕЛЬ</label>
                                <input type="text" class="input" id="prot-suspect" placeholder="Найти гражданина..." style="margin-bottom:15px;">
                                
                                <label style="font-size:0.8rem; color:#888;">СТАТЬИ ОБВИНЕНИЯ</label>
                                <div style="height: 200px; overflow-y:auto; background: #000; border:1px solid #333; padding:10px;" id="laws-list">
                                    </div>
                            </div>
                            <div>
                                <label style="font-size:0.8rem; color:#888;">ОПИСАНИЕ СИТУАЦИИ</label>
                                <textarea class="input" style="height:150px; resize:none; margin-bottom:15px;"></textarea>
                                
                                <div style="background: rgba(255,255,255,0.05); padding:15px; border-radius:4px;">
                                    <div style="font-size:0.8rem; color:#888;">ИТОГОВОЕ НАКАЗАНИЕ:</div>
                                    <div id="total-punishment" style="font-size:1.2rem; font-weight:bold; color:var(--accent);">0 $ / 0 месяцев</div>
                                </div>
                                <br>
                                <button class="btn btn-primary" style="width:100%; justify-content:center;" onclick="alert('Рапорт отправлен в архив!')">ПОДПИСАТЬ И ОТПРАВИТЬ</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="mod-patients" class="module">
                    <div class="card"><h3>РЕЕСТР ГОСПИТАЛИЗАЦИИ</h3><p>Доступно только для сотрудников EMS.</p></div>
                </div>

            </div>
        </main>

        <div class="radio-panel">
            <div style="padding: 15px; border-bottom: 1px solid var(--border-light); font-weight: bold; background: #151515;">
                <i class="fas fa-broadcast-tower" style="color: var(--status-danger);"></i> 911 / RADIO
            </div>
            <div class="radio-feed" id="radio-feed">
                </div>
            <div style="padding: 10px; border-top: 1px solid var(--border-light);">
                <input type="text" class="input" placeholder="Тен-код..." style="font-size: 0.8rem;">
            </div>
        </div>
    </div>

    <div id="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">ДОСЬЕ #001</h3>
                <button class="btn" onclick="closeModal()">✕</button>
            </div>
            <div class="modal-body">
                <div class="flex gap-20">
                    <div style="width: 120px; height: 150px; background: #333; display:flex; align-items:center; justify-content:center; color:#555;">NO PHOTO</div>
                    <div style="flex:1;">
                        <div class="grid-2">
                            <div><div style="font-size:0.7rem; color:#888;">ИМЯ</div><div id="m-name" class="bold">Name</div></div>
                            <div><div style="font-size:0.7rem; color:#888;">ВОЗРАСТ</div><div id="m-age">00</div></div>
                            <div><div style="font-size:0.7rem; color:#888;">ПОЛ</div><div id="m-gender">M</div></div>
                            <div><div style="font-size:0.7rem; color:#888;">СТАТУС</div><div id="m-status">Clean</div></div>
                        </div>
                        <br>
                        <div style="font-size:0.7rem; color:#888;">ЛИЦЕНЗИИ</div>
                        <div id="m-lic" class="flex gap-10"></div>
                    </div>
                </div>
                <hr style="border:0; border-bottom:1px solid #333; margin: 20px 0;">
                <h4>ИСТОРИЯ АРЕСТОВ</h4>
                <table id="m-history">
                    <thead><tr><th>Дата</th><th>Статья</th><th>Офицер</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // --- DATA GENERATOR ---
        const firstNames = ["James", "John", "Robert", "Michael", "William", "David", "Richard", "Joseph", "Thomas", "Charles", "Ivan", "Dmitry", "Sergey", "Alex"];
        const lastNames = ["Smith", "Johnson", "Williams", "Jones", "Brown", "Davis", "Miller", "Wilson", "Moore", "Taylor", "Petrov", "Ivanov", "Sidorov"];
        const statuses = ["CLEAN", "WANTED", "PAROLE", "MISSING"];
        
        let citizensDB = [];
        let lawsDB = [
            { id: "10.5", txt: "Превышение скорости", fine: 500, jail: 0 },
            { id: "12.8", txt: "Управление в нетрезвом виде", fine: 5000, jail: 15 },
            { id: "17.1", txt: "Посягательство на жизнь сотрудника", fine: 25000, jail: 100 },
            { id: "6.1",  txt: "Неподчинение", fine: 2000, jail: 10 },
            { id: "2.3",  txt: "Ограбление бизнеса", fine: 10000, jail: 40 },
        ];

        // Init Dummy Data
        for(let i=0; i<50; i++) {
            citizensDB.push({
                id: 1000 + i,
                name: `${firstNames[Math.floor(Math.random()*firstNames.length)]} ${lastNames[Math.floor(Math.random()*lastNames.length)]}`,
                age: 18 + Math.floor(Math.random()*60),
                gender: Math.random() > 0.2 ? "M" : "F",
                status: Math.random() > 0.9 ? "WANTED" : "CLEAN",
                licenses: ["Drive B"],
                history: Math.random() > 0.7 ? [{date: "01.01.2023", reason: "10.5 Traffic", officer: "LSPD"}] : []
            });
        }

        let userRole = "LSPD";

        // --- SYSTEM FUNCTIONS ---
        function bootSystem() {
            const u = document.getElementById('login-user').value;
            const d = document.getElementById('login-dept').value;
            if(!u) return alert("ВВЕДИТЕ ДАННЫЕ");

            userRole = d;
            document.getElementById('ui-user').innerText = u;
            document.getElementById('ui-dept').innerText = d === 'LSPD' ? "POLICE DEPT." : "EMERGENCY SERVICES";

            // Theme Switch
            if(d === 'EMS') {
                document.documentElement.style.setProperty('--accent', '#ef4444');
                document.documentElement.style.setProperty('--accent-glow', 'rgba(239, 68, 68, 0.4)');
                document.querySelector('.mvd-only').classList.add('hidden');
                document.querySelector('.ems-only').classList.remove('hidden');
            }

            // Animation
            const overlay = document.getElementById('login-overlay');
            const app = document.getElementById('app');
            
            overlay.style.opacity = 0;
            setTimeout(() => {
                overlay.style.display = 'none';
                app.style.opacity = 1;
                initMap();
                renderBolo();
                renderLaws();
                startRadio();
            }, 1000);
        }

        function nav(mod) {
            document.querySelectorAll('.module').forEach(m => m.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            document.getElementById('mod-' + mod).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // --- FEATURES ---
        function performSearch() {
            const q = document.getElementById('search-input').value.toLowerCase();
            const res = document.getElementById('search-results');
            res.innerHTML = "";

            if(q.length < 2) return;

            const found = citizensDB.filter(c => c.name.toLowerCase().includes(q) || c.id.toString().includes(q));

            found.forEach(c => {
                let color = c.status === 'WANTED' ? 'var(--status-danger)' : 'var(--status-ok)';
                res.innerHTML += `
                    <div class="card" onclick="openModal(${c.id})">
                        <div class="flex" style="justify-content:space-between">
                            <h3 style="margin:0">${c.name}</h3>
                            <span class="tag" style="background:${color}; color:#000">${c.status}</span>
                        </div>
                        <div style="font-size:0.8rem; color:#888; margin-top:5px;">ID: ${c.id} | Возраст: ${c.age}</div>
                    </div>
                `;
            });
            if(found.length === 0) res.innerHTML = "<div style='color:#666'>Ничего не найдено</div>";
        }

        function openModal(id) {
            const c = citizensDB.find(x => x.id === id);
            if(!c) return;

            document.getElementById('modal-title').innerText = "ДОСЬЕ #" + c.id;
            document.getElementById('m-name').innerText = c.name;
            document.getElementById('m-age').innerText = c.age;
            document.getElementById('m-gender').innerText = c.gender;
            
            const st = document.getElementById('m-status');
            st.innerText = c.status;
            st.style.color = c.status === 'WANTED' ? 'red' : 'green';

            document.getElementById('m-lic').innerHTML = c.licenses.map(l => `<span class="tag tag-green">${l}</span>`).join('');
            
            const hist = document.querySelector('#m-history tbody');
            hist.innerHTML = c.history.map(h => `<tr><td>${h.date}</td><td>${h.reason}</td><td>${h.officer}</td></tr>`).join('') || "<tr><td colspan='3' style='color:#555'>Записей нет</td></tr>";

            document.getElementById('modal-overlay').style.display = 'flex';
        }

        function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

        function renderLaws() {
            const list = document.getElementById('laws-list');
            lawsDB.forEach(l => {
                const div = document.createElement('div');
                div.style.padding = "5px"; div.style.borderBottom = "1px solid #222"; div.style.cursor = "pointer";
                div.innerHTML = `<span style="color:var(--accent); font-weight:bold;">${l.id}</span> ${l.txt}`;
                div.onclick = function() {
                    this.style.background = "#222";
                    updatePunishment(l.fine, l.jail);
                };
                list.appendChild(div);
            });
        }

        let totalFine = 0, totalJail = 0;
        function updatePunishment(f, j) {
            totalFine += f; totalJail += j;
            document.getElementById('total-punishment').innerText = `${totalFine} $ / ${totalJail} месяцев`;
        }

        function renderBolo() {
            const bolo = document.getElementById('bolo-list');
            const wanted = citizensDB.filter(c => c.status === 'WANTED').slice(0, 3);
            wanted.forEach(w => {
                bolo.innerHTML += `
                    <div style="display:flex; gap:10px; margin-bottom:10px; background:rgba(255,0,0,0.1); padding:10px; border-left:3px solid red;">
                        <div style="width:40px; height:40px; background:#333;"></div>
                        <div>
                            <div class="bold" style="color:#faa;">${w.name}</div>
                            <div style="font-size:0.75rem;">Розыск: Особо тяжкие</div>
                        </div>
                    </div>
                `;
            });
        }

        // --- MAP SIMULATION ---
        function initMap() {
            const map = document.getElementById('map-box');
            // Add random blips
            for(let i=0; i<5; i++) {
                const b = document.createElement('div');
                b.className = 'blip';
                b.style.top = Math.random() * 80 + 10 + "%";
                b.style.left = Math.random() * 80 + 10 + "%";
                map.appendChild(b);
            }
        }

        // --- RADIO SIMULATION ---
        function startRadio() {
            const msgs = [
                "10-55, Черный Buffalo, район Вайнвуд",
                "Диспетчер: Код 2 всем патрулям, драка в баре",
                "UNIT-12: Выхожу на смену, 10-8",
                "UNIT-04: Принял вызов 312",
                "Система: Новый ордер добавлен в базу"
            ];
            const feed = document.getElementById('radio-feed');
            
            setInterval(() => {
                const m = msgs[Math.floor(Math.random() * msgs.length)];
                const isPrio = m.includes("Код 3") || m.includes("ордер");
                const div = document.createElement('div');
                div.className = `radio-msg ${isPrio ? 'priority' : ''}`;
                div.innerHTML = `<span style="opacity:0.6">[${new Date().toLocaleTimeString().slice(0,5)}]</span> ${m}`;
                feed.insertBefore(div, feed.firstChild);
                if(feed.children.length > 20) feed.lastChild.remove();
            }, 5000);
        }
        
        // Clock
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);

    </script>
</body>
</html>
